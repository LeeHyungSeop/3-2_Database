<!-- login 성공되면서 동시에 main page -->
<html>
<head>
    <title>Volunteer Main Page</title>
</head>
    <h2>안녕하세요 회원님!</h2>
    회원님의 현재 위치를 알려주세요.
    가까운 곳의 노인복지회관을 찾아드릴게요.
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>  
    <br></br>

    
    <select id="sido" onchange="optionChange();">
        <option value="0">시/도</option>
        <option value="1">서울특별시</option>
        <option value="2">부산광역시</option>
        <option value="3">대구광역시</option>
        <option value="4">인천광역시</option>
        <option value="5">광주광역시</option>
        <option value="6">대전광역시</option>
        <option value="7">울산광역시</option>
        <option value="8">세종특별자치시</option>
        <option value="9">경기도</option>
        <option value="10">강원도</option>
        <option value="11">충청북도</option>
        <option value="12">충청남도</option>
        <option value="13">전라북도</option>
        <option value="14">전라남도</option>
        <option value="15">경상북도</option>
        <option value="16">경상남도</option>
        <option value="17">제주특별자치도</option>
    </select>

    <select id="sigungu">
        <option>시/군/구</option>
    </select>

    <script>
        const key = "jiOmJfJl1DuS3wgn5gO+iklZUufTTr9upGZyPm2fHmlqVIuj0pUuUa7ixsTrQK1asGso3S73YM6bx49f2bnFbg==";
        const url = "https://api.odcloud.kr/api/15004317/v1/uddi:a27dc8f0-26b8-42ca-8f4c-c33da26e51a1_201909202206";
    
        const sidoDropdown = document.getElementById('sido');
        const sigunguDropdown = document.getElementById('sigungu');
    
        const queryParams = {
            serviceKey: key,
            page: '1',
            perPage: '1000',
            returnType: 'JSON',
        };
        
        var data=null;
        var selectedSido=null;
        var selectedSigungu=null;
        // axios를 이용해 open API 호출, data에 response.data를 저장
        axios.get(url, { params: queryParams })
            .then(response => {
                console.log('Status:', response.status);
                console.log('Headers:', response.headers);
                console.log('Body:', response.data);
                data = JSON.stringify(response.data, null, 2);
                // data를 array로 만들기
                data = Array.from(JSON.parse(data).data);
                console.log(data)
            }).catch(error => {
                    console.error('Error:', error);
            });

        // 시/도 dropdown에서 선택된 값을 이용하여 시/군/구 dropdown에 option 추가 (dynamic select 구현)
        function optionChange() {
            // Get the selected value from sido dropdown
            selectedSido = sidoDropdown.options[sidoDropdown.selectedIndex].text;
            console.log("selectedSido's value : " + selectedSido);
            
            // selectedSido값과 일치하는 "시도" element만 추출
            const filteredData = data.filter(item => item.시도 === selectedSido);
            console.log("filteredData : " + filteredData);
            // 추출한 data에서 unique "시군구"값만 추출
            const uniqueSigungu = [...new Set(filteredData.map(item => item.시군구))];
            console.log("uniqueSigungu : " + uniqueSigungu);
            
            // uniqueSigungu값을 sigungu dropdown에 추가
            sigunguDropdown.innerHTML = '<option></option>';
            uniqueSigungu.forEach(item => {
                sigunguDropdown.innerHTML += `<option>${item}</option>`;
            });
        }

        // sigungu dropdown에서 선택된 값을 출력
        sigunguDropdown.addEventListener('change', () => {
            const selectedSigungu = sigunguDropdown.options[sigunguDropdown.selectedIndex].text;
            
            <!-- selectedSido, selectedSigungu값으로 Naver Map에 검색하여 근처의 노인복지회관 정보 제공할 것임 -->
            console.log('user가 선택한 시/도 : ' + selectedSido);
            console.log('user가 선택한 시/군/구 : ' + selectedSigungu);
        });


    </script>
                

</html>
